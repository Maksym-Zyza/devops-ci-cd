# Lesson 8-9: Jenkins CI/CD, EKS, ECR, and Helm with Terraform

–¶–µ–π –ø—Ä–æ—î–∫—Ç —Ä–æ–∑–≥–æ—Ä—Ç–∞—î Kubernetes –∫–ª–∞—Å—Ç–µ—Ä –Ω–∞ AWS –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Terraform, –Ω–∞–ª–∞—à—Ç–æ–≤—É—î Elastic Container Registry (ECR), —Ä–æ–∑–≥–æ—Ä—Ç–∞—î Django-–∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ —á–µ—Ä–µ–∑ Helm, –∞ —Ç–∞–∫–æ–∂ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î Jenkins –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó CI/CD –ø—Ä–æ—Ü–µ—Å—ñ–≤.

### –ó–∞–≤–¥–∞–Ω–Ω—è

1.  **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–ª–∞—Å—Ç–µ—Ä–∞ Kubernetes —á–µ—Ä–µ–∑ Terraform.**
2.  **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Elastic Container Registry (ECR)** –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è Docker-–æ–±—Ä–∞–∑—É –≤–∞—à–æ–≥–æ Django-–∑–∞—Å—Ç–æ—Å—É–Ω–∫—É.
3.  **–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Docker-–æ–±—Ä–∞–∑—É Django –¥–æ ECR.**
4.  **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è Helm Chart** (deployment.yaml, service.yaml, hpa.yaml, configmap.yaml).
5.  **–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ (env)** –∑ —Ç–µ–º–∏ 4 –≤ ConfigMap, —è–∫–∏–π –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –≤–∞—à–∏–º –∑–∞—Å—Ç–æ—Å—É–Ω–∫–æ–º.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É

```bash
lesson-8-9/
‚îÇ
‚îú‚îÄ‚îÄ main.tf                  # –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –º–æ–¥—É–ª—ñ–≤
‚îú‚îÄ‚îÄ backend.tf               # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–µ–∫–µ–Ω–¥—É –¥–ª—è —Å—Ç–µ–π—Ç—ñ–≤ (S3 + DynamoDB)
‚îú‚îÄ‚îÄ outputs.tf               # –ó–∞–≥–∞–ª—å–Ω—ñ –≤–∏–≤–æ–¥–∏ —Ä–µ—Å—É—Ä—Å—ñ–≤
‚îÇ
‚îú‚îÄ‚îÄ modules/                 # –ö–∞—Ç–∞–ª–æ–≥ –∑ —É—Å—ñ–º–∞ –º–æ–¥—É–ª—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ s3-backend/          # –ú–æ–¥—É–ª—å –¥–ª—è S3 —Ç–∞ DynamoDB
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ s3.tf            # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è S3-–±–∞–∫–µ—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dynamodb.tf      # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è DynamoDB
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf     # –ó–º—ñ–Ω–Ω—ñ –¥–ª—è S3
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ outputs.tf       # –í–∏–≤–µ–¥–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ S3 —Ç–∞ DynamoDB
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ vpc/                 # –ú–æ–¥—É–ª—å –¥–ª—è VPC
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vpc.tf           # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è VPC, –ø—ñ–¥–º–µ—Ä–µ–∂, Internet Gateway
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes.tf        # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf     # –ó–º—ñ–Ω–Ω—ñ –¥–ª—è VPC
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ outputs.tf       # –í–∏–≤–µ–¥–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ VPC
‚îÇ   ‚îú‚îÄ‚îÄ ecr/                 # –ú–æ–¥—É–ª—å –¥–ª—è ECR
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ecr.tf           # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è ECR —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf     # –ó–º—ñ–Ω–Ω—ñ –¥–ª—è ECR
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ outputs.tf       # –í–∏–≤–µ–¥–µ–Ω–Ω—è URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ eks/                 # –ú–æ–¥—É–ª—å –¥–ª—è Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ eks.tf           # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–ª–∞—Å—Ç–µ—Ä–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ node.tf          # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–¥-–≥—Ä—É–ø–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ aws_ebs_csi_driver.tf # ‚úÖ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–ª–∞–≥—ñ–Ω–∞ EBS CSI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf     # –ó–º—ñ–Ω–Ω—ñ –¥–ª—è EKS
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ outputs.tf       # –í–∏–≤–µ–¥–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –∫–ª–∞—Å—Ç–µ—Ä
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ jenkins/             # ‚úÖ –ù–æ–≤–∏–π –º–æ–¥—É–ª—å –¥–ª—è Jenkins
‚îÇ       ‚îú‚îÄ‚îÄ jenkins.tf       # Helm release –¥–ª—è Jenkins
‚îÇ       ‚îú‚îÄ‚îÄ variables.tf     # –ó–º—ñ–Ω–Ω—ñ
‚îÇ       ‚îú‚îÄ‚îÄ values.yaml      # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Jenkins
‚îÇ       ‚îî‚îÄ‚îÄ outputs.tf       # –í–∏–≤–æ–¥–∏
‚îÇ
‚îú‚îÄ‚îÄ charts/
‚îÇ   ‚îî‚îÄ‚îÄ django-app/
‚îÇ       ‚îú‚îÄ‚îÄ templates/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ configmap.yaml
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ deployment.yaml
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ hpa.yaml
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ service.yaml
‚îÇ       ‚îú‚îÄ‚îÄ Chart.yaml
‚îÇ       ‚îî‚îÄ‚îÄ values.yaml
```

### –û–ø–∏—Å –º–æ–¥—É–ª—ñ–≤

#### 1. `modules/s3-backend`
–¶–µ–π –º–æ–¥—É–ª—å —Å—Ç–≤–æ—Ä—é—î —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è –∫–æ–º–∞–Ω–¥–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –∑ Terraform:
- AWS S3 Bucket: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ñ–∞–π–ª—É —Å—Ç–∞–Ω—É (terraform.tfstate). –£–≤—ñ–º–∫–Ω–µ–Ω–æ –≤–µ—Ä—Å—ñ—é–≤–∞–Ω–Ω—è –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö —Å—Ç–∞–Ω—ñ–≤.
- AWS DynamoDB Table: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –º–µ—Ö–∞–Ω—ñ–∑–º—É –±–ª–æ–∫—É–≤–∞–Ω–Ω—è (State Locking), —â–æ–± –∑–∞–ø–æ–±—ñ–≥—Ç–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–∏–º –∑–º—ñ–Ω–∞–º —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Ä—ñ–∑–Ω–∏–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏.

#### 2. `modules/vpc`
–ú–æ–¥—É–ª—å —Ä–æ–∑–≥–æ—Ä—Ç–∞—î –≤—ñ—Ä—Ç—É–∞–ª—å–Ω—É –ø—Ä–∏–≤–∞—Ç–Ω—É —Ö–º–∞—Ä—É (VPC):
- VPC: –Ü–∑–æ–ª—å–æ–≤–∞–Ω–∞ –º–µ—Ä–µ–∂–∞ –∑ –≤–ª–∞—Å–Ω–∏–º CIDR –±–ª–æ–∫–æ–º.
- Subnets: –°—Ç–≤–æ—Ä—é—î –ø—É–±–ª—ñ—á–Ω—ñ —Ç–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ñ –ø—ñ–¥–º–µ—Ä–µ–∂—ñ —É —Ä—ñ–∑–Ω–∏—Ö –∑–æ–Ω–∞—Ö –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ (Availability Zones) –¥–ª—è –≤–∏—Å–æ–∫–æ—ó –≤—ñ–¥–º–æ–≤–æ—Å—Ç—ñ–π–∫–æ—Å—Ç—ñ.
- Internet Gateway: –ó–∞–±–µ–∑–ø–µ—á—É—î –¥–æ—Å—Ç—É–ø –¥–æ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É –¥–ª—è —Ä–µ—Å—É—Ä—Å—ñ–≤ —É –ø—É–±–ª—ñ—á–Ω–∏—Ö –ø—ñ–¥–º–µ—Ä–µ–∂–∞—Ö.
- Route Tables: –ù–∞–ª–∞—à—Ç–æ–≤—É—î –ø—Ä–∞–≤–∏–ª–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó —Ç—Ä–∞—Ñ—ñ–∫—É.

#### 3. `modules/ecr`
–ú–æ–¥—É–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è Docker-–æ–±—Ä–∞–∑–∞–º–∏:
- ECR Repository: –ü—Ä–∏–≤–∞—Ç–Ω–∏–π —Ä–µ—î—Å—Ç—Ä –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –æ–±—Ä–∞–∑—ñ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤.
- Image Scanning: –£–≤—ñ–º–∫–Ω–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –æ–±—Ä–∞–∑—ñ–≤ –Ω–∞ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ (push).

#### 4. `modules/eks`
–ú–æ–¥—É–ª—å –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è EKS –∫–ª–∞—Å—Ç–µ—Ä–∞ –∑ —Ä–æ–±–æ—á–∏–º–∏ –Ω–æ–¥–∞–º–∏.
- EKS Cluster: –°—Ç–≤–æ—Ä—é—î –∫–ª–∞—Å—Ç–µ—Ä Kubernetes —É –≤–∫–∞–∑–∞–Ω–∏—Ö –ø—ñ–¥–º–µ—Ä–µ–∂–∞—Ö.
- Worker Nodes: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é—î –≥—Ä—É–ø—É EC2 —ñ–Ω—Å—Ç–∞–Ω—Å—ñ–≤ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –ø—ñ–¥ –∫–µ—Ä—É–≤–∞–Ω–Ω—è–º EKS.
- IAM Roles: –ì–µ–Ω–µ—Ä—É—î –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —Ä–æ–ª—ñ –¥–ª—è —Ä–æ–±–æ—á–∏—Ö –Ω–æ–¥—ñ–≤ —Ç–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –∫–ª–∞—Å—Ç–µ—Ä—É.
- VPC Integration: –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ VPC —Ç–∞ –ø—ñ–¥–º–µ—Ä–µ–∂–∞–º–∏ (public / private).
- Autoscaling: –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è —Ä–æ–±–æ—á–∏—Ö –Ω–æ–¥—ñ–≤ —á–µ—Ä–µ–∑ desired_size, min_size, max_size.
- Outputs: –î–æ–∑–≤–æ–ª—è—î –æ—Ç—Ä–∏–º–∞—Ç–∏ endpoint –∫–ª–∞—Å—Ç–µ—Ä–∞, –Ω–∞–∑–≤—É —Ç–∞ ARN —Ä–æ–ª—ñ –Ω–æ–¥—ñ–≤.

–î–æ–¥–∞—Ç–∫–æ–≤–æ, —Ü–µ–π –º–æ–¥—É–ª—å —Ç–µ–ø–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î **AWS EBS CSI Driver**. –¶–µ –¥–æ–∑–≤–æ–ª—è—î Kubernetes –¥–∏–Ω–∞–º—ñ—á–Ω–æ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ `PersistentVolume` –Ω–∞ –±–∞–∑—ñ AWS EBS, —â–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –¥–ª—è —Ä–æ–±–æ—Ç–∏ stateful-–¥–æ–¥–∞—Ç–∫—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ Jenkins.

#### 5. `modules/jenkins`
–¶–µ–π –º–æ–¥—É–ª—å —Ä–æ–∑–≥–æ—Ä—Ç–∞—î Jenkins —É Kubernetes –∫–ª–∞—Å—Ç–µ—Ä –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –æ—Ñ—ñ—Ü—ñ–π–Ω–æ–≥–æ Helm-—á–∞—Ä—Ç—É.
- **Helm Release:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î Jenkins –≤ –æ–∫—Ä–µ–º–∏–π –Ω–µ–π–º—Å–ø–µ–π—Å `jenkins`.
- **Persistent Storage:** –°—Ç–≤–æ—Ä—é—î `PersistentVolumeClaim` –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö Jenkins (–∑–∞–≤–¥–∞–Ω—å, –ø–ª–∞–≥—ñ–Ω—ñ–≤, –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π) –º—ñ–∂ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏.
- **LoadBalancer Service:** –ó–∞–±–µ–∑–ø–µ—á—É—î –∑–æ–≤–Ω—ñ—à–Ω—ñ–π –¥–æ—Å—Ç—É–ø –¥–æ Jenkins —á–µ—Ä–µ–∑ –ø—É–±–ª—ñ—á–Ω—É IP-–∞–¥—Ä–µ—Å—É.
- **Pre-installed Plugins:** –í–∫–ª—é—á–∞—î –Ω–∞–±—ñ—Ä –∫–ª—é—á–æ–≤–∏—Ö –ø–ª–∞–≥—ñ–Ω—ñ–≤ –¥–ª—è CI/CD, —Ç–∞–∫–∏—Ö —è–∫ `kubernetes`, `git`, `github`, `workflow-aggregator`.

#### üõ† –Ø–∫ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –ø—Ä–æ—î–∫—Ç
**–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ –≤–∏–º–æ–≥–∏**
- –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π Terraform
- –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π AWS CLI —Ç–∞ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø (aws configure)
- –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π `kubectl`
- –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π `helm`

### –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –∑ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏
1.  **–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Terraform** –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∏ —Ç–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î –º–æ–¥—É–ª—ñ/–±–µ–∫–µ–Ω–¥.

    ```bash
    terraform init
    ```
    (–ü—Ä–∏–º—ñ—Ç–∫–∞: –Ø–∫—â–æ –≤–∏ –∑–∞–ø—É—Å–∫–∞—î—Ç–µ –ø—Ä–æ—î–∫—Ç –≤–ø–µ—Ä—à–µ —ñ –±–∞–∫–µ—Ç –¥–ª—è —Å—Ç–µ–π—Ç—É —â–µ –Ω–µ —ñ—Å–Ω—É—î, –∑–∞–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ –±–ª–æ–∫ `backend "s3"` —É —Ñ–∞–π–ª—ñ `backend.tf`, –≤–∏–∫–æ–Ω–∞–π—Ç–µ `apply`, –∞ –ø–æ—Ç—ñ–º —Ä–æ–∑–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ —ñ –≤–∏–∫–æ–Ω–∞–π—Ç–µ `terraform init -reconfigure`).

2.  **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–ª–∞–Ω—É** –°—Ç–≤–æ—Ä—é—î –ø–ª–∞–Ω –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, –ø–æ–∫–∞–∑—É—é—á–∏ —Ä–µ—Å—É—Ä—Å–∏, —è–∫—ñ –±—É–¥—É—Ç—å —Å—Ç–≤–æ—Ä–µ–Ω—ñ.

    ```bash
    terraform plan
    ```

3.  **–ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω** –†–æ–∑–≥–æ—Ä—Ç–∞—î —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ AWS.
    ```bash
    terraform apply
    ```
    –ü—ñ–¥—Ç–≤–µ—Ä–¥—å—Ç–µ –¥—ñ—é, –≤–≤—ñ–≤—à–∏ `yes`.

### –î–µ—Ç–∞–ª—å–Ω—ñ –∫—Ä–æ–∫–∏ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É

–ü—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Terraform, –≤–∏–∫–æ–Ω–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏ –¥–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –≤–∞—à–æ–≥–æ Django-–∑–∞—Å—Ç–æ—Å—É–Ω–∫—É.

### 4. –î–æ—Å—Ç—É–ø –¥–æ Jenkins

–ü—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è `terraform apply` Jenkins –±—É–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π —É –∫–ª–∞—Å—Ç–µ—Ä.

**a. –û—Ç—Ä–∏–º–∞–Ω–Ω—è URL –¥–ª—è –¥–æ—Å—Ç—É–ø—É:**

Jenkins —Ä–æ–∑–≥–æ—Ä—Ç–∞—î—Ç—å—Å—è –∑ —Å–µ—Ä–≤—ñ—Å–æ–º —Ç–∏–ø—É `LoadBalancer`. –©–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –π–æ–≥–æ –∑–æ–≤–Ω—ñ—à–Ω—é IP-–∞–¥—Ä–µ—Å—É –∞–±–æ DNS-—ñ–º'—è, –≤–∏–∫–æ–Ω–∞–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```bash
kubectl get svc jenkins -n jenkins
```
–ó–Ω–∞–π–¥—ñ—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è —É –∫–æ–ª–æ–Ω—Ü—ñ `EXTERNAL-IP`. –î–æ—Å—Ç—É–ø –¥–æ Jenkins –±—É–¥–µ –∑–∞ –∞–¥—Ä–µ—Å–æ—é `http://<EXTERNAL-IP>`.

**b. –î–∞–Ω—ñ –¥–ª—è –≤—Ö–æ–¥—É:**

–ó–≥—ñ–¥–Ω–æ –∑ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏–º —Ñ–∞–π–ª–æ–º `values.yaml`, –ø–æ—á–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–ª—è –≤—Ö–æ–¥—É:
- **Username:** `admin`
- **Password:** `admin123`

‚ùóÔ∏è **–í–∞–∂–ª–∏–≤–æ:** –¶–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó. –ü–æ—Ç—Ä—ñ–±–Ω–æ –∑–º—ñ–Ω–∏—Ç–∏ –π–æ–≥–æ –ø—ñ—Å–ª—è –ø–µ—Ä—à–æ–≥–æ –≤—Ö–æ–¥—É.

#### 1. –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ EKS –∫–ª–∞—Å—Ç–µ—Ä–∞
–ù–∞–ª–∞—à—Ç—É–π—Ç–µ `kubectl` –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ –≤–∞—à–∏–º –Ω–æ–≤–∏–º EKS –∫–ª–∞—Å—Ç–µ—Ä–æ–º.

```bash
aws eks update-kubeconfig --region us-west-2 --name eks-cluster-demo
```

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è:
```bash
kubectl get nodes
```

#### 2. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Docker-–æ–±—Ä–∞–∑—É –≤ ECR
–¶—ñ –∫–æ–º–∞–Ω–¥–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –≤–∞—à–æ–≥–æ Django-–ø—Ä–æ—î–∫—Ç—É, –¥–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è `Dockerfile`.

a. **–ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è Docker —É ECR:**
```bash
aws ecr get-login-password --region us-west-2 | docker login --username AWS --password-stdin 088581047201.dkr.ecr.us-west-2.amazonaws.com
```

b. **Build Docker-–æ–±—Ä–∞–∑—É:**
```bash
docker build --no-cache --platform=linux/amd64 -t 088581047201.dkr.ecr.us-west-2.amazonaws.com/django-app:latest .
```

c. **–¢–µ–≥—É–≤–∞–Ω–Ω—è –æ–±—Ä–∞–∑—É:**
```bash
docker tag django-app:latest 088581047201.dkr.ecr.us-west-2.amazonaws.com/django-app:latest
```

d. **Push –æ–±—Ä–∞–∑—É –≤ ECR:**
```bash
docker push 088581047201.dkr.ecr.us-west-2.amazonaws.com/django-app:latest
```

#### 3. –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Helm
a. **–û–Ω–æ–≤—ñ—Ç—å `values.yaml`:**
–ü–µ—Ä–µ–¥ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è–º, –≤—ñ–¥–∫—Ä–∏–π—Ç–µ —Ñ–∞–π–ª `lesson-7/charts/django-app/values.yaml` —Ç–∞ –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –≤–∫–∞–∑–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π —Ç–∞ —Ç–µ–≥ –¥–ª—è –≤–∞—à–æ–≥–æ –æ–±—Ä–∞–∑—É:

```yaml
image:
  repository: 088581047201.dkr.ecr.us-west-2.amazonaws.com/django-app
  tag: latest
```

b. **–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–±–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è Helm-—Ä–µ–ª—ñ–∑—É:**
–¶—è –∫–æ–º–∞–Ω–¥–∞ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–∞—Ä—Ç, —è–∫—â–æ –π–æ–≥–æ —â–µ –Ω–µ–º–∞—î, –∞–±–æ –æ–Ω–æ–≤–∏—Ç—å —ñ—Å–Ω—É—é—á–∏–π.
```bash
helm upgrade --install django-app ./charts/django-app --namespace django --create-namespace
```

#### 4. –ó–Ω–∏—â–µ–Ω–Ω—è —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏
–Ø–∫—â–æ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—ñ–ª—å—à–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞, –≤–∏–¥–∞–ª—ñ—Ç—å —Ä–µ—Å—É—Ä—Å–∏, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –≤–∏—Ç—Ä–∞—Ç.
```bash
terraform destroy
```

### ‚öôÔ∏è –í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ (Variables)
–û—Å–Ω–æ–≤–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –Ω–∞–ª–∞—à—Ç–æ–≤—É—é—Ç—å—Å—è —É —Ñ–∞–π–ª—ñ `main.tf` –ø—Ä–∏ –≤–∏–∫–ª–∏–∫—É –º–æ–¥—É–ª—ñ–≤:
- `vpc_cidr_block`: CIDR –±–ª–æ–∫ –¥–ª—è VPC.
- `public_subnets`: –°–ø–∏—Å–æ–∫ ID –ø—É–±–ª—ñ—á–Ω–∏—Ö –ø—ñ–¥–º–µ—Ä–µ–∂.
- `private_subnets`: –°–ø–∏—Å–æ–∫ ID –ø—Ä–∏–≤–∞—Ç–Ω–∏—Ö –ø—ñ–¥–º–µ—Ä–µ–∂.
- `bucket_name`: –£–Ω—ñ–∫–∞–ª—å–Ω–µ —ñ–º'—è –¥–ª—è S3 –±–∞–∫–µ—Ç–∞.
- `repository_name`: –Ü–º'—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é.
- `cluster_name`: –ù–∞–∑–≤–∞ EKS –∫–ª–∞—Å—Ç–µ—Ä–∞.
- `subnet_ids`: ID –ø—ñ–¥–º–µ—Ä–µ–∂ –¥–ª—è EKS –Ω–æ–¥—ñ–≤.
- `instance_type`: –¢–∏–ø EC2 —ñ–Ω—Å—Ç–∞–Ω—Å—ñ–≤ –¥–ª—è —Ä–æ–±–æ—á–∏—Ö –Ω–æ–¥—ñ–≤.
- `desired_size`: –ë–∞–∂–∞–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–æ–¥—ñ–≤ —É –≥—Ä—É–ø—ñ.
- `max_size`: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–æ–¥—ñ–≤.
- `min_size`: –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–æ–¥—ñ–≤.


#### –°—Ç–≤–æ—Ä–µ–Ω—ñ AWS —Ä–µ—Å—É—Ä—Å–∏

###### –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –≤ AWS
![alt text](assets/terraform-apply.png)

###### AWS S3 Backet
![alt text](assets/aws-state-s3.png)

###### AWS VPC
![alt text](assets/aws_vpc.png)

###### AWS ECR
![alt text](assets/aws_ecr.png)


### –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:
1. –£ –≤–∞—à–æ–º—É AWS-–∞–∫–∞—É–Ω—Ç—ñ —Å—Ç–≤–æ—Ä–µ–Ω–æ –∫–ª–∞—Å—Ç–µ—Ä Kubernetes.
![alt text](assets/aws_eks.png)

2. ECR –º—ñ—Å—Ç–∏—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏–π Docker-–æ–±—Ä–∞–∑ Django-–∑–∞—Å—Ç–æ—Å—É–Ω–∫—É.
![alt text](assets/aws_ecr_image.png)

3. –ó–∞—Å—Ç–æ—Å—É–Ω–æ–∫ —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–∏–π —É –∫–ª–∞—Å—Ç–µ—Ä—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Helm-—á–∞—Ä—Ç–∞.
  ![alt text](assets/helm_chart.png)

4. Service –∑–∞–±–µ–∑–ø–µ—á—É—î –¥–æ—Å—Ç—É–ø –¥–æ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É —á–µ—Ä–µ–∑ –ø—É–±–ª—ñ—á–Ω—É IP-–∞–¥—Ä–µ—Å—É.
```bash
kubectl get pods -n django -w 
```
![alt text](assets/get-pods.png)

- Get services:
```bash
kubectl get svc -n django
```
![alt text](assets/web-test.png)

- Port-forward:
```bash
kubectl port-forward -n django service/django-app 8080:80
```

5. ConfigMap –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É —á–µ—Ä–µ–∑ Helm.
    –í–∏–≤–µ—Å—Ç–∏ –≤—Å—ñ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –ø–æ–¥—É:
```bash
kubectl exec -n django django-app-cd9bccdd4-lc6k7 -- printenv
```
![alt text](assets/config-map.png)

6. HPA –¥–∏–Ω–∞–º—ñ—á–Ω–æ –º–∞—Å—à—Ç–∞–±—É—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–¥—ñ–≤.

- –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Metrics Server:
```bash
kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
```

- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ HPA:
```bash
kubectl get hpa -n django
```
![alt text](assets/scaling-test.png)