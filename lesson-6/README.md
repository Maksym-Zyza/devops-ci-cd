# devops-ci-cd

## Lesson 5: AWS Infrastructure with Terraform Modules

–¶–µ–π –ø—Ä–æ—î–∫—Ç —Ä–æ–∑–≥–æ—Ä—Ç–∞—î –±–∞–∑–æ–≤—É —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω–∞ AWS, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –º–æ–¥—É–ª—å–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ —É Terraform. –ü—Ä–æ—î–∫—Ç –≤–∫–ª—é—á–∞—î –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–≥–æ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Å—Ç–∞–Ω—É (S3 Backend), –º–µ—Ä–µ–∂–µ–≤—É —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (VPC) —Ç–∞ —Ä–µ—î—Å—Ç—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤ (ECR).

### –û–ø–∏—Å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –ø—Ä–æ—î–∫—Ç—É.

```bash
lesson-5/
‚îÇ
‚îú‚îÄ‚îÄ main.tf                  # –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –º–æ–¥—É–ª—ñ–≤
‚îú‚îÄ‚îÄ backend.tf               # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–µ–∫–µ–Ω–¥—É –¥–ª—è —Å—Ç–µ–π—Ç—ñ–≤ (S3 + DynamoDB)
‚îú‚îÄ‚îÄ outputs.tf               # –ó–∞–≥–∞–ª—å–Ω–µ –≤–∏–≤–µ–¥–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤
‚îÇ
‚îú‚îÄ‚îÄ modules/                 # –ö–∞—Ç–∞–ª–æ–≥ –∑ —É—Å—ñ–º–∞ –º–æ–¥—É–ª—è–º–∏
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ s3-backend/          # –ú–æ–¥—É–ª—å –¥–ª—è S3 —Ç–∞ DynamoDB
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ s3.tf            # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è S3-–±–∞–∫–µ—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dynamodb.tf      # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è DynamoDB
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf     # –ó–º—ñ–Ω–Ω—ñ –¥–ª—è S3
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ outputs.tf       # –í–∏–≤–µ–¥–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ S3 —Ç–∞ DynamoDB
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ vpc/                 # –ú–æ–¥—É–ª—å –¥–ª—è VPC
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vpc.tf           # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è VPC, –ø—ñ–¥–º–µ—Ä–µ–∂, Internet Gateway
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes.tf        # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf     # –ó–º—ñ–Ω–Ω—ñ –¥–ª—è VPC
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ outputs.tf       # –í–∏–≤–µ–¥–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ VPC
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ ecr/                 # –ú–æ–¥—É–ª—å –¥–ª—è ECR
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ecr.tf           # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è ECR —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf     # –ó–º—ñ–Ω–Ω—ñ –¥–ª—è ECR
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ outputs.tf       # –í–∏–≤–µ–¥–µ–Ω–Ω—è URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é ECR
‚îÇ   ‚îî‚îÄ‚îÄ eks/                 # –ú–æ–¥—É–ª—å –¥–ª—è EKS
‚îÇ       ‚îú‚îÄ‚îÄ eks.tf           # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è EKS-–∫–ª–∞—Å—Ç–µ—Ä–∞ —Ç–∞ –≤–æ—Ä–∫–µ—Ä—ñ–≤
‚îÇ       ‚îú‚îÄ‚îÄ variables.tf     # –ó–º—ñ–Ω–Ω—ñ –¥–ª—è EKS
‚îÇ       ‚îú‚îÄ‚îÄ outputs.tf       # –í–∏–≤–µ–¥–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ EKS
‚îÇ       ‚îî‚îÄ‚îÄ node.tf          # IAM-—Ä–æ–ª—ñ –¥–ª—è EKS
‚îÇ
‚îî‚îÄ‚îÄ README.md                # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –ø—Ä–æ—î–∫—Ç—É

```

### –û–ø–∏—Å –º–æ–¥—É–ª—ñ–≤

#### 1. modules/s3-backend
–¶–µ–π –º–æ–¥—É–ª—å —Å—Ç–≤–æ—Ä—é—î —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è –∫–æ–º–∞–Ω–¥–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –∑ Terraform:
- AWS S3 Bucket: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ñ–∞–π–ª—É —Å—Ç–∞–Ω—É (terraform.tfstate). –£–≤—ñ–º–∫–Ω–µ–Ω–æ –≤–µ—Ä—Å—ñ—é–≤–∞–Ω–Ω—è –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö —Å—Ç–∞–Ω—ñ–≤.
- AWS DynamoDB Table: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –º–µ—Ö–∞–Ω—ñ–∑–º—É –±–ª–æ–∫—É–≤–∞–Ω–Ω—è (State Locking), —â–æ–± –∑–∞–ø–æ–±—ñ–≥—Ç–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–∏–º –∑–º—ñ–Ω–∞–º —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Ä—ñ–∑–Ω–∏–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏.

#### 2. modules/vpc
–ú–æ–¥—É–ª—å —Ä–æ–∑–≥–æ—Ä—Ç–∞—î –≤—ñ—Ä—Ç—É–∞–ª—å–Ω—É –ø—Ä–∏–≤–∞—Ç–Ω—É —Ö–º–∞—Ä—É (VPC):
- VPC: –Ü–∑–æ–ª—å–æ–≤–∞–Ω–∞ –º–µ—Ä–µ–∂–∞ –∑ –≤–ª–∞—Å–Ω–∏–º CIDR –±–ª–æ–∫–æ–º.
- Subnets: –°—Ç–≤–æ—Ä—é—î –ø—É–±–ª—ñ—á–Ω—ñ —Ç–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ñ –ø—ñ–¥–º–µ—Ä–µ–∂—ñ —É —Ä—ñ–∑–Ω–∏—Ö –∑–æ–Ω–∞—Ö –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ (Availability Zones) –¥–ª—è –≤–∏—Å–æ–∫–æ—ó –≤—ñ–¥–º–æ–≤–æ—Å—Ç—ñ–π–∫–æ—Å—Ç—ñ.
- Internet Gateway: –ó–∞–±–µ–∑–ø–µ—á—É—î –¥–æ—Å—Ç—É–ø –¥–æ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É –¥–ª—è —Ä–µ—Å—É—Ä—Å—ñ–≤ —É –ø—É–±–ª—ñ—á–Ω–∏—Ö –ø—ñ–¥–º–µ—Ä–µ–∂–∞—Ö.
- Route Tables: –ù–∞–ª–∞—à—Ç–æ–≤—É—î –ø—Ä–∞–≤–∏–ª–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó —Ç—Ä–∞—Ñ—ñ–∫—É.

#### 3. modules/ecr
–ú–æ–¥—É–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è Docker-–æ–±—Ä–∞–∑–∞–º–∏:
- ECR Repository: –ü—Ä–∏–≤–∞—Ç–Ω–∏–π —Ä–µ—î—Å—Ç—Ä –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –æ–±—Ä–∞–∑—ñ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤.
- Image Scanning: –£–≤—ñ–º–∫–Ω–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –æ–±—Ä–∞–∑—ñ–≤ –Ω–∞ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ (push).

#### 4. modules/eks
–ú–æ–¥—É–ª—å –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è EKS –∫–ª–∞—Å—Ç–µ—Ä–∞ –∑ —Ä–æ–±–æ—á–∏–º–∏ –Ω–æ–¥–∞–º–∏.
- EKS Cluster: –°—Ç–≤–æ—Ä—é—î –∫–ª–∞—Å—Ç–µ—Ä Kubernetes —É –≤–∫–∞–∑–∞–Ω–∏—Ö –ø—ñ–¥–º–µ—Ä–µ–∂–∞—Ö.
- Worker Nodes: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é—î –≥—Ä—É–ø—É EC2 —ñ–Ω—Å—Ç–∞–Ω—Å—ñ–≤ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –ø—ñ–¥ –∫–µ—Ä—É–≤–∞–Ω–Ω—è–º EKS.
- IAM Roles: –ì–µ–Ω–µ—Ä—É—î –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —Ä–æ–ª—ñ –¥–ª—è —Ä–æ–±–æ—á–∏—Ö –Ω–æ–¥—ñ–≤ —Ç–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –∫–ª–∞—Å—Ç–µ—Ä—É.
- VPC Integration: –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ VPC —Ç–∞ –ø—ñ–¥–º–µ—Ä–µ–∂–∞–º–∏ (public / private).
- Autoscaling: –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è —Ä–æ–±–æ—á–∏—Ö –Ω–æ–¥—ñ–≤ —á–µ—Ä–µ–∑ desired_size, min_size, max_size.
- Outputs: –î–æ–∑–≤–æ–ª—è—î –æ—Ç—Ä–∏–º–∞—Ç–∏ endpoint –∫–ª–∞—Å—Ç–µ—Ä–∞, –Ω–∞–∑–≤—É —Ç–∞ ARN —Ä–æ–ª—ñ –Ω–æ–¥—ñ–≤.
  
#### üõ† –Ø–∫ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –ø—Ä–æ—î–∫—Ç
–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ –≤–∏–º–æ–≥–∏
–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π Terraform

–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π AWS CLI —Ç–∞ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø (aws configure)

### –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –∑ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è
1. –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Terraform –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∏ —Ç–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î –º–æ–¥—É–ª—ñ/–±–µ–∫–µ–Ω–¥.

```Bash
terraform init
```
(–ü—Ä–∏–º—ñ—Ç–∫–∞: –Ø–∫—â–æ –≤–∏ –∑–∞–ø—É—Å–∫–∞—î—Ç–µ –ø—Ä–æ—î–∫—Ç –≤–ø–µ—Ä—à–µ —ñ –±–∞–∫–µ—Ç –¥–ª—è —Å—Ç–µ–π—Ç—É —â–µ –Ω–µ —ñ—Å–Ω—É—î, –∑–∞–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ –±–ª–æ–∫ backend "s3" —É —Ñ–∞–π–ª—ñ backend.tf, –≤–∏–∫–æ–Ω–∞–π—Ç–µ apply, –∞ –ø–æ—Ç—ñ–º —Ä–æ–∑–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ —ñ –≤–∏–∫–æ–Ω–∞–π—Ç–µ terraform init -reconfigure).

2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–ª–∞–Ω—É –°—Ç–≤–æ—Ä—é—î –ø–ª–∞–Ω –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, –ø–æ–∫–∞–∑—É—é—á–∏ —Ä–µ—Å—É—Ä—Å–∏, —è–∫—ñ –±—É–¥—É—Ç—å —Å—Ç–≤–æ—Ä–µ–Ω—ñ.

```Bash
terraform plan
```

3. –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω –†–æ–∑–≥–æ—Ä—Ç–∞—î —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ AWS.
```Bash
terraform apply
```
–ü—ñ–¥—Ç–≤–µ—Ä–¥—å—Ç–µ –¥—ñ—é, –≤–≤—ñ–≤—à–∏ yes.

4. –ó–Ω–∏—â–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ –Ø–∫—â–æ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—ñ–ª—å—à–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞, –≤–∏–¥–∞–ª—ñ—Ç—å —Ä–µ—Å—É—Ä—Å–∏, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –≤–∏—Ç—Ä–∞—Ç.
```Bash
terraform destroy
```

### ‚öôÔ∏è –í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ (Variables)
–û—Å–Ω–æ–≤–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –Ω–∞–ª–∞—à—Ç–æ–≤—É—é—Ç—å—Å—è —É —Ñ–∞–π–ª—ñ main.tf –ø—Ä–∏ –≤–∏–∫–ª–∏–∫—É –º–æ–¥—É–ª—ñ–≤:
- vpc_cidr_block: CIDR –±–ª–æ–∫ –¥–ª—è VPC.
- public_subnets: –°–ø–∏—Å–æ–∫ ID –ø—É–±–ª—ñ—á–Ω–∏—Ö –ø—ñ–¥–º–µ—Ä–µ–∂.
- private_subnets: –°–ø–∏—Å–æ–∫ ID –ø—Ä–∏–≤–∞—Ç–Ω–∏—Ö –ø—ñ–¥–º–µ—Ä–µ–∂.
- bucket_name: –£–Ω—ñ–∫–∞–ª—å–Ω–µ —ñ–º'—è –¥–ª—è S3 –±–∞–∫–µ—Ç–∞.
- repository_name: –Ü–º'—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é.
- cluster_name: –ù–∞–∑–≤–∞ EKS –∫–ª–∞—Å—Ç–µ—Ä–∞.
- subnet_ids: ID –ø—ñ–¥–º–µ—Ä–µ–∂ –¥–ª—è EKS –Ω–æ–¥—ñ–≤.
- instance_type: –¢–∏–ø EC2 —ñ–Ω—Å—Ç–∞–Ω—Å—ñ–≤ –¥–ª—è —Ä–æ–±–æ—á–∏—Ö –Ω–æ–¥—ñ–≤.
- desired_size: –ë–∞–∂–∞–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–æ–¥—ñ–≤ —É –≥—Ä—É–ø—ñ.
- max_size: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–æ–¥—ñ–≤.
- min_size: –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–æ–¥—ñ–≤.


#### –°—Ç–≤–æ—Ä–µ–Ω—ñ AWS —Ä–µ—Å—É—Ä—Å–∏

###### –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –≤ AWS
![alt text](assets/terraform-apply.png)

###### AWS S3 Backet
![alt text](assets/aws-state-s3.png)

###### AWS VPC
![alt text](assets/aws_vpc.png)

###### AWS ECR
![alt text](assets/aws_ecr.png)


